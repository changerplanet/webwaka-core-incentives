
üîì PHASE 3D-3 ‚Äî CORE INCENTIVES IMPLEMENTATION

Execution Platform: Replit
Repository: changerplanet/webwaka-core-incentives
Phase Type: Core / Headless / Deterministic Library
Status: IMPLEMENTATION (spec locked)

‚∏ª

CONTEXT (READ CAREFULLY)

You are implementing Phase 3D-3 ‚Äî Core Incentives for the WebWaka platform.

This is a CORE SUBSTRATE MODULE, not a UI, not a runtime service.

üö´ DO NOT build dashboards
üö´ DO NOT build wallets or payouts
üö´ DO NOT integrate payments
üö´ DO NOT store balances
üö´ DO NOT introduce databases
üö´ DO NOT add cron jobs or background workers

This module is pure evaluation only.

‚∏ª

SOURCE OF TRUTH (IMMUTABLE)
	‚Ä¢	WebWaka Ecosystem Constitution v1.5+
	‚Ä¢	Phase 3D-2 Core Incentives Specification (LOCKED)

All rules, precedence, exclusions, and guarantees come only from the specification.

‚∏ª

REPOSITORY REQUIREMENT (CRITICAL)

üîí CLONING RULE (NON-NEGOTIABLE)
	1.	You MUST clone the repository
https://github.com/changerplanet/webwaka-core-incentives
	2.	If the repository is empty:
	‚Ä¢	Clone it AS-IS
	‚Ä¢	üö´ DO NOT add placeholders
	‚Ä¢	üö´ DO NOT scaffold templates
	‚Ä¢	üö´ DO NOT add demo code
	3.	If Replit auto-creates files:
	‚Ä¢	DELETE them immediately
	‚Ä¢	The repo must reflect only Phase 3D-3 implementation

‚ùó If cloning fails ‚Üí STOP and report

‚∏ª

IMPLEMENTATION OBJECTIVE

Implement a pure, deterministic incentive evaluation engine that:
	‚Ä¢	Supports monetary incentives and points
	‚Ä¢	Handles flat, percentage, tiered, multi-level, lifetime incentives
	‚Ä¢	Produces ledger-ready results
	‚Ä¢	Supports offline evaluation via snapshots
	‚Ä¢	Enforces strict tenant isolation
	‚Ä¢	Enforces strict precedence hierarchy

‚∏ª

REQUIRED DOMAIN MODELS (ZOD-VALIDATED)

You MUST implement all of the following (exact semantics from spec):
	‚Ä¢	IncentiveDefinition
	‚Ä¢	IncentiveRule
	‚Ä¢	IncentiveValue
	‚Ä¢	IncentiveRelationship
	‚Ä¢	IncentiveEvaluationContext
	‚Ä¢	IncentiveResult
	‚Ä¢	IncentiveSnapshot

All models must be:
	‚Ä¢	Immutable
	‚Ä¢	JSON-serializable
	‚Ä¢	Deterministic

‚∏ª

CORE APIs (MANDATORY)

1Ô∏è‚É£ Incentive Evaluation

evaluateIncentives(
  definition: IncentiveDefinition,
  context: IncentiveEvaluationContext,
  rules: IncentiveRule[]
): IncentiveResult[]

Requirements
	‚Ä¢	Pure function
	‚Ä¢	No side effects
	‚Ä¢	No mutation
	‚Ä¢	Deterministic (10√ó repeat proof required)

‚∏ª

2Ô∏è‚É£ Snapshot Support (MANDATORY)

generateIncentiveSnapshot(...)
verifySnapshot(snapshot)
evaluateFromSnapshot(snapshot, context)

Snapshot Guarantees
	‚Ä¢	SHA-256 checksum
	‚Ä¢	Deterministic snapshot ID
	‚Ä¢	Tamper detection
	‚Ä¢	Offline evaluable

‚∏ª

PRECEDENCE (STRICT ‚Äî MUST MATCH)

From highest ‚Üí lowest:
	1.	Individual overrides
	2.	Campaign rules
	3.	Partner rules
	4.	Tenant rules
	5.	System defaults

If precedence is violated ‚Üí FAIL

‚∏ª

TENANT ISOLATION (CRITICAL)
	‚Ä¢	All inputs must include tenantId
	‚Ä¢	Referral chains must validate tenant consistency
	‚Ä¢	Cross-tenant access must throw a hard error

‚∏ª

LEDGER READINESS (CRITICAL)

Each IncentiveResult MUST include:
	‚Ä¢	tenantId
	‚Ä¢	subjectId
	‚Ä¢	amount
	‚Ä¢	currency or unit
	‚Ä¢	sourceType: "incentive"
	‚Ä¢	incentiveId
	‚Ä¢	ruleId
	‚Ä¢	idempotencyKey
	‚Ä¢	Optional attribution chain

‚ùå NO balance updates
‚ùå NO wallet logic

‚∏ª

TEST REQUIREMENTS (NON-NEGOTIABLE)

You MUST implement tests proving:
	1.	Determinism
	‚Ä¢	Same inputs ‚Üí same outputs (10√ó repeat)
	2.	Precedence correctness
	‚Ä¢	Higher precedence overrides lower
	3.	Tenant isolation
	‚Ä¢	Cross-tenant access rejected
	4.	Snapshot integrity
	‚Ä¢	Tampering detected
	‚Ä¢	Offline evaluation matches live evaluation
	5.	Multi-level attribution
	‚Ä¢	Referral chains produce correct results

Coverage
	‚Ä¢	‚â• 80% statement coverage (required)
	‚Ä¢	Prefer ‚â• 90%

‚∏ª

EXPLICIT EXCLUSIONS (DO NOT IMPLEMENT)

‚ùå Wallets
‚ùå Payout execution
‚ùå Subscriptions
‚ùå Payments
‚ùå Taxes
‚ùå UI
‚ùå Background jobs
‚ùå External APIs
‚ùå Persistence

‚∏ª

REQUIRED FINAL OUTPUT

When complete, produce a Completion Summary including:
	‚Ä¢	APIs implemented
	‚Ä¢	Incentive types supported
	‚Ä¢	Precedence enforcement proof
	‚Ä¢	Snapshot guarantees
	‚Ä¢	Test count + coverage
	‚Ä¢	Hard-Stop proof statement
	‚Ä¢	Final commit SHA

‚∏ª

‚õî HARD STOP

After implementation:

‚õî STOP
‚õî DO NOT proceed to Phase 3E
‚õî Await explicit authorization

‚∏ª

ACKNOWLEDGEMENT FORMAT

Reply only with:

‚ÄúPhase 3D-3 acknowledged. Implementing Core Incentives exactly as specified.‚Äù

Then execute.